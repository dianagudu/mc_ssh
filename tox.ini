[tox]
minversion = 3.10.0
envlist =
       pylint,
       # py{37,38,39,310},
       pyright,
       black,
       # docs,
       # coverage,
       build
skipsdist = True
skip_missing_interpreters = True

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: pylint, black, pyright, build  # , py310, coverage

[base]
deps = 
       -r requirements.txt
       -r test-requirements.txt
module = mccli

[testenv]
deps = {[base]deps}
commands =
       pytest

[testenv:py310]
deps =
       {[base]deps}
commands =
       pytest --cov={[base]module} --cov-report=term-missing:skip-covered
       coverage lcov

[testenv:coverage]
deps =
       {[base]deps}
       coverage-badge
commands =
       pytest --cov={[base]module} --cov-report=term-missing:skip-covered
       coverage-badge -f -o coverage.svg

[testenv:pylint]
deps =
       {[base]deps}
       pylint
commands = pylint --exit-zero {[base]module}

[testenv:black]
deps = black
commands = black -l 100 --check --diff {[base]module}

[testenv:pyright]
deps =
        {[base]deps}
        pyright
commands = pyright {[base]module}

[testenv:docs]
deps =
       -r requirements.txt
       -r doc/source/requirements.txt
commands = sphinx-build doc/source doc/build


[testenv:build]
deps =
       build
       twine
commands =
       python -m build --sdist .
       twine check dist/*

[testenv:install]
deps =
       build
       twine
       pip
passenv =
    TWINE_PASSWORD
setenv =
    TWINE_USERNAME = {env:TWINE_USERNAME:__token__}
commands =
       python -m build --sdist .
       twine upload --repository-url https://test.pypi.org/legacy/ dist/*
       pip install -U -i https://testpypi.python.org/simple {[base]module}
       {[base]module} --help


[testenv:release]
deps =
       build
       twine
pippassenv =
    TWINE_PASSWORD
setenv =
    TWINE_USERNAME = {env:TWINE_USERNAME:__token__}
commands =
       python -m build  --sdist .
       twine upload dist/*